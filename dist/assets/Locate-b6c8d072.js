import{e as o,y as i,n as h,l as S,m as k,t as I}from"./cast-34ff1fab.js";import{r as $}from"./typedArrayUtil-6bfe4dae.js";import{b as M}from"./ensureType-abaf235a.js";import{e as E,M as J,n as x}from"./jsxFactory-c9fe78a4.js";import"./intl-4434dd8e.js";import{k as W}from"./PopupTemplate-7faa8256.js";import{s as z,a as _,b as L}from"./Error-e5869661.js";import{e as B,t as q,a as F,b as V}from"./GoTo-4ce030df.js";import{a as K}from"./assets-4600b25c.js";import T from"./Graphic-94225496.js";import{n as Q}from"./Evented-fac53f7f.js";import{n as X}from"./symbols-c29482ec.js";import{h as Y}from"./string-46813dd9.js";import{w as Z,R as ee}from"./Extent-b8913cd1.js";import{j as te}from"./Portal-ed3455de.js";import"./request-0ae6f728.js";import"./geometry-1b3a0099.js";import{m as G}from"./Polyline-7684a66d.js";import{s as f}from"./jsonMap-92eea954.js";import{v as w}from"./jsonUtils-eb956695.js";import{a as oe,n as ie}from"./project-8f2fbe78.js";import{s as re}from"./locale-30120714.js";import{u as se}from"./messages-fe8e2c1f.js";import"./nextTick-3ee5a785.js";import"./promiseUtils-281d25c9.js";import"./Promise-19e65545.js";import"./reactiveUtils-aec98ee9.js";import"./uuid-73213768.js";import"./number-4b1bfb24.js";import"./Clonable-a26a28b0.js";import"./Collection-3317d203.js";import"./SimpleObservable-f97014ec.js";import"./fieldUtils-ba80cc48.js";import"./preload-helper-596b5639.js";import"./arcadeOnDemand-8d1e3277.js";import"./enumeration-e40d8895.js";import"./Identifiable-016ad07d.js";import"./typeUtils-0cf27003.js";import"./CIMSymbol-31fb7ca2.js";import"./Symbol-8a110cc7.js";import"./Color-0f9fdd46.js";import"./colorUtils-639f4d25.js";import"./mathUtils-daf59e84.js";import"./common-701a4199.js";import"./screenUtils-7afeb41c.js";import"./opacityUtils-ea6b845d.js";import"./SimpleFillSymbol-80498a78.js";import"./aaBoundingBox-77ee83e3.js";import"./persistableUrlUtils-94eb42ca.js";import"./collectionUtils-23cca63a.js";import"./Loadable-3c0fb2d0.js";import"./PortalGroup-506cda94.js";import"./PortalUser-d46abb74.js";import"./utils-97034790.js";new f({MGRS:"mgrs",USNG:"usng",UTM:"utm",GeoRef:"geo-ref",GARS:"gars",DMS:"dms",DDM:"ddm",DD:"dd"});new f({109006:"centimeters",9102:"decimal-degrees",109005:"decimeters",9002:"feet",109009:"inches",9036:"kilometers",9001:"meters",9035:"miles",109007:"millimeters",109012:"nautical-miles",9096:"yards"});let g=class extends S{constructor(t){super(t),this.deviationUnit=null,this.geometries=null,this.maxDeviation=null}};o([i({type:String,json:{write:!0}})],g.prototype,"deviationUnit",void 0),o([i({json:{read:{reader:e=>e?e.map(t=>w(t)).filter($):null},write:{writer:(e,t)=>{t.geometries=(e==null?void 0:e.map(r=>r.toJSON()))??null}}}})],g.prototype,"geometries",void 0),o([i({type:Number,json:{write:!0}})],g.prototype,"maxDeviation",void 0),g=o([h("esri.rest.support.GeneralizeParameters")],g),g.from=M(g);new f({preserveShape:"preserve-shape"});let d=class extends S{constructor(t){super(t),this.calculationType=null,this.geodesic=null,this.lengthUnit=null,this.polylines=null}};o([i({type:String,json:{write:!0}})],d.prototype,"calculationType",void 0),o([i({type:Boolean,json:{write:!0}})],d.prototype,"geodesic",void 0),o([i({json:{write:!0}})],d.prototype,"lengthUnit",void 0),o([i({type:[G],json:{read:{reader:e=>e?e.map(t=>w(t)):null},write:{writer:(e,t)=>{t.polylines=e.map(r=>r.toJSON())}}}})],d.prototype,"polylines",void 0),d=o([h("esri.rest.support.LengthsParameters")],d),d.from=M(d);new f({esriGeometryOffsetBevelled:"bevelled",esriGeometryOffsetMitered:"mitered",esriGeometryOffsetRounded:"rounded"});new f({9001:"meters",9002:"feet",9036:"kilometers",9093:"miles",109012:"nautical-miles",109001:"yards"});let p=class extends S{constructor(t){super(t),this.bevelRatio=null,this.geometries=null,this.offsetDistance=null,this.offsetHow=null,this.offsetUnit=null}};o([i({type:Number,json:{write:!0}})],p.prototype,"bevelRatio",void 0),o([i({json:{read:{reader:e=>e?e.map(t=>w(t)).filter($):null},write:{writer:(e,t)=>{t.geometries=(e==null?void 0:e.map(r=>r.toJSON()))??null}}}})],p.prototype,"geometries",void 0),o([i({type:Number,json:{write:!0}})],p.prototype,"offsetDistance",void 0),o([i({type:String,json:{write:!0}})],p.prototype,"offsetHow",void 0),o([i({type:String,json:{write:!0}})],p.prototype,"offsetUnit",void 0),p=o([h("esri.rest.support.OffsetParameters")],p),p.from=M(p);new f({esriGeometryRelationCross:"cross",esriGeometryRelationDisjoint:"disjoint",esriGeometryRelationIn:"in",esriGeometryRelationInteriorIntersection:"interior-intersection",esriGeometryRelationIntersection:"intersection",esriGeometryRelationLineCoincidence:"line-coincidence",esriGeometryRelationLineTouch:"line-touch",esriGeometryRelationOverlap:"overlap",esriGeometryRelationPointTouch:"point-touch",esriGeometryRelationTouch:"touch",esriGeometryRelationWithin:"within",esriGeometryRelationRelation:"relation"});let u=class extends S{constructor(t){super(t),this.geometries1=null,this.geometries2=null,this.relation=null,this.relationParameter=null}};o([i({json:{read:{reader:e=>e?e.map(t=>w(t)).filter($):null},write:{writer:(e,t)=>{t.geometries1=(e==null?void 0:e.map(r=>r.toJSON()))??null}}}})],u.prototype,"geometries1",void 0),o([i({json:{read:{reader:e=>e?e.map(t=>w(t)).filter($):null},write:{writer:(e,t)=>{t.geometries2=(e==null?void 0:e.map(r=>r.toJSON()))??null}}}})],u.prototype,"geometries2",void 0),o([i({type:String,json:{write:!0}})],u.prototype,"relation",void 0),o([i({type:String,json:{write:!0}})],u.prototype,"relationParameter",void 0),u=o([h("esri.rest.support.RelationParameters")],u),u.from=M(u);new f({0:"default-curve-extension",1:"relocate-ends",2:"keep-end-attributes",4:"no-end-attributes",8:"no-extend-at-from",16:"no-extend-at-to"});let y=class extends S{constructor(e){super(e),this.extendHow="default-curve-extension",this.polylines=null,this.trimExtendTo=null}};o([i({type:String,json:{write:!0}})],y.prototype,"extendHow",void 0),o([i({type:[G],json:{read:{reader:e=>e?e.map(t=>w(t)):null},write:{writer:(e,t)=>{t.polylines=e.map(r=>r.toJSON())}}}})],y.prototype,"polylines",void 0),o([i({json:{read:{reader:e=>e?w(e):null},write:{writer:(e,t)=>{t.trimExtendTo=e.toJSON()}}}})],y.prototype,"trimExtendTo",void 0),y=o([h("esri.rest.support.TrimExtendParameters")],y),y.from=M(y);const O=z.getLogger("esri.widgets.support.geolocationUtils"),ne={maximumAge:0,timeout:15e3,enableHighAccuracy:!0};function ae(){const e=Y("esri-geolocation");return e||O.warn("geolocation-unsupported","Geolocation unsupported."),e}function le(){const e=window.isSecureContext;return e||O.warn("insecure-context","Geolocation requires a secure origin."),e}function pe(){return ae()&&le()}function ce(e){return e||(e=ne),new Promise((r,s)=>{setTimeout(()=>s(new _("geolocation:timeout","getting the current geolocation position timed out")),15e3),navigator.geolocation.getCurrentPosition(r,s,e)})}function de(e,t){const{position:r,view:s}=e;return he(me(ue(r)),s,t)}function ue(e){const t=e&&e.coords||{},r={accuracy:t.accuracy,altitude:t.altitude,altitudeAccuracy:t.altitudeAccuracy,heading:t.heading,latitude:t.latitude,longitude:t.longitude,speed:t.speed};return e&&{coords:r,timestamp:e.timestamp}}function me(e){const t=e&&e.coords;return t?new Z({longitude:t.longitude,latitude:t.latitude,z:t.altitude||null,spatialReference:{wkid:4326}}):null}function he(e,t,r){if(!t)return Promise.resolve(e);const s=t.spatialReference;return s.isWGS84?Promise.resolve(e):s.isWebMercator?Promise.resolve(ee(e)):ge(r).then(n=>{if(!n)throw new _("geometry-service:missing-url","Geometry service URL is missing");const b=new oe({geometries:[e],outSpatialReference:s});return ie(n,b,r).then(v=>v[0])})}function ge(e){if(L.geometryServiceUrl)return Promise.resolve(L.geometryServiceUrl);const t=te.getDefault();return t.load(e).catch(()=>{}).then(()=>t.get("helperServices.geometry.url"))}const ye=2500;let l=class extends B(Q.EventedMixin(k)){constructor(){super(...arguments),this._geolocationUsable=!0,this._iconPath=K("esri/images/support/sdk_gps_location.png"),this.geolocationOptions=null,this.goToLocationEnabled=!0,this.graphic=new T({symbol:new X({url:this._iconPath,width:21,height:21})}),this.scale=null,this.useHeadingEnabled=!0,this.view=null}initialize(){pe()||(this._geolocationUsable=!1)}destroy(){this._clear(),this.view=null}_clear(){this.view&&this.view.graphics.remove(this.graphic)}_getScaleWithinConstraints(e,t){if(!t)return e;if(t.type==="2d"){const{effectiveMaxScale:r,effectiveMinScale:s}=t.constraints;return Math.min(s,Math.max(r,e))}return e}_getScale(e){const{scale:t}=this,r=typeof t=="number"?t:ye;return this._getScaleWithinConstraints(r,e)}_getHeading(e,t){const r=t&&t.spatialReference,s=r&&(r.isWebMercator||r.isGeographic),n=e.coords&&e.coords.heading;if(!(!s||typeof n!="number"||isNaN(n)||n<0||n>360))return n}_addHeading(e){const{heading:t,target:r,view:s}=e;s&&typeof t=="number"&&!isNaN(t)&&(s.type!=="3d"?s.type==="2d"&&(r.rotation=360-t):r.heading=t)}_animatePoint(e,t,r,s){const{view:n}=this;if(!this.goToLocationEnabled||!n)return Promise.resolve(t);const b=this.useHeadingEnabled?this._getHeading(t,n):void 0,v={target:e,scale:r};return this._addHeading({heading:b,target:v,view:n}),this.callGoTo({target:v,options:s}).then(()=>t)}async _setPosition(e,t){try{const r=await de({position:e,view:this.view},t),{graphic:s}=this,{timestamp:n}=e,{coords:b}=e,{accuracy:v,altitude:R,altitudeAccuracy:C,heading:j,latitude:N,longitude:H,speed:U}=b,D={timestamp:n,accuracy:v,altitude:R,altitudeAccuracy:C,heading:j,latitude:N,longitude:H,speed:U};s&&(s.geometry=r,s.attributes=D);const A=this._getScale(this.view);return this._animatePoint(r,e,A,t)}catch(r){throw new _("positioning:invalid-point","Cannot position invalid point",{error:r})}}};o([i()],l.prototype,"_geolocationUsable",void 0),o([i()],l.prototype,"geolocationOptions",void 0),o([i()],l.prototype,"goToLocationEnabled",void 0),o([i({type:T,nonNullable:!0})],l.prototype,"graphic",void 0),o([i()],l.prototype,"scale",void 0),o([i()],l.prototype,"useHeadingEnabled",void 0),o([i()],l.prototype,"view",void 0),l=o([h("esri.widgets.support.GeolocationPositioning")],l);const we=l;async function fe(){const e=await se("esri/widgets/Locate/t9n/Locate");return new W({title:e.currentLocation,fieldInfos:[{fieldName:"timestamp",label:e.timestamp,format:{dateFormat:"short-date-short-time"}},{fieldName:"latitude",label:e.latitude,format:{places:4,digitSeparator:!0}},{fieldName:"longitude",label:e.longitude,format:{places:4,digitSeparator:!0}},{fieldName:"accuracy",label:e.accuracy,format:{places:0,digitSeparator:!0}},{fieldName:"altitude",label:e.altitude,format:{places:0,digitSeparator:!0}},{fieldName:"altitudeAccuracy",label:e.altitudeAccuracy,format:{places:0,digitSeparator:!0}},{fieldName:"heading",label:e.heading,format:{places:0,digitSeparator:!0}},{fieldName:"speed",label:e.speed,format:{places:0,digitSeparator:!0}}],actions:[q.clone()],content:[{type:"fields"}]})}let m=class extends we{constructor(e){super(e),this._locateController=null,this._handles=new I,this.popupEnabled=!0,this.locate=this.locate.bind(this)}initialize(){this._handles.add([re(()=>{var s;const{graphic:e,view:t}=this;((s=t==null?void 0:t.graphics)==null?void 0:s.includes(e))&&this._updatePopupTemplate(e)})])}destroy(){this.cancelLocate(),this._handles.destroy(),this._handles=null}get state(){return this._geolocationUsable?this.get("view.ready")?this._locateController?"locating":"ready":"disabled":"feature-unsupported"}async locate(){if(this.cancelLocate(),this.state==="disabled")throw new _("locate:disabled-state","Cannot locate when disabled.");if(this.state==="feature-unsupported")throw new _("locate:feature-unsupported-state","Cannot locate in unsecure domain.");const e=new AbortController;this._locateController=e;try{let t=await ce(this.geolocationOptions);return t=await this._setPosition(t,{signal:e.signal}),this._locateController!==e?null:(this.graphic&&(this.graphic=this.graphic.clone(),await this._updatePopupTemplate(this.graphic),this.view.graphics.push(this.graphic)),this.emit("locate",{position:t}),this._locateController=null,t)}catch(t){throw this._locateController=null,this.emit("locate-error",{error:t}),t}}cancelLocate(){this._clear(),this._locateController&&this._locateController.abort(),this._locateController=null}async _updatePopupTemplate(e){if(!this.popupEnabled)return;const t=await fe(),r=e!==this.graphic;this.destroyed||r||(e.popupTemplate=t)}};o([i()],m.prototype,"_locateController",void 0),o([i()],m.prototype,"popupEnabled",void 0),o([i({readOnly:!0})],m.prototype,"state",null),o([i()],m.prototype,"locate",null),o([i()],m.prototype,"cancelLocate",null),m=o([h("esri.widgets.Locate.LocateViewModel")],m);const P=m,c={base:"esri-locate esri-widget--button esri-widget",text:"esri-icon-font-fallback-text",icon:"esri-icon",locate:"esri-icon-locate",loading:"esri-icon-loading-indicator",rotating:"esri-rotating",widgetIcon:"esri-icon-north-navigation",disabled:"esri-disabled",hidden:"esri-hidden"};let a=class extends J{constructor(e,t){super(e,t),this.iconClass=c.widgetIcon,this.messages=null,this.messagesCommon=null,this.viewModel=new P}get geolocationOptions(){return this.viewModel.geolocationOptions}set geolocationOptions(e){this.viewModel.geolocationOptions=e}get goToLocationEnabled(){return this.viewModel.goToLocationEnabled}set goToLocationEnabled(e){this.viewModel.goToLocationEnabled=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get popupEnabled(){return this.viewModel.popupEnabled}set popupEnabled(e){this.viewModel.popupEnabled=e}get scale(){return this.viewModel.scale}set scale(e){this.viewModel.scale=e}get useHeadingEnabled(){return this.viewModel.useHeadingEnabled}set useHeadingEnabled(e){this.viewModel.useHeadingEnabled=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}cancelLocate(){this.viewModel.cancelLocate()}locate(){return this.viewModel.locate()}render(){const e=this.get("viewModel.state"),t=e==="locating",r={[c.disabled]:e==="disabled",[c.hidden]:e==="feature-unsupported"},s={[c.loading]:t,[c.rotating]:t,[c.locate]:!t},n=e==="locating"?this.messagesCommon.cancel:this.messages.title;return x("div",{bind:this,class:this.classes(c.base,r),hidden:e==="feature-unsupported",onclick:this._locate,onkeydown:this._locate,role:"button",tabIndex:0,"aria-label":n,title:n},x("span",{"aria-hidden":"true",class:this.classes(c.icon,s)}),x("span",{class:c.text},this.messages.title))}_locate(){const{viewModel:e}=this;e.state==="locating"?e.cancelLocate():e.locate()}};o([i()],a.prototype,"geolocationOptions",null),o([i()],a.prototype,"goToLocationEnabled",null),o([i()],a.prototype,"goToOverride",null),o([i()],a.prototype,"graphic",null),o([i()],a.prototype,"iconClass",void 0),o([i()],a.prototype,"label",null),o([i(),E("esri/widgets/Locate/t9n/Locate")],a.prototype,"messages",void 0),o([i(),E("esri/t9n/common")],a.prototype,"messagesCommon",void 0),o([i()],a.prototype,"popupEnabled",null),o([i()],a.prototype,"scale",null),o([i()],a.prototype,"useHeadingEnabled",null),o([i()],a.prototype,"view",null),o([i({type:P}),F(["locate","locate-error"])],a.prototype,"viewModel",void 0),o([V()],a.prototype,"_locate",null),a=o([h("esri.widgets.Locate")],a);const Mt=a;export{Mt as default};
